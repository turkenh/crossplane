# Compile stage
FROM golang:1.19 AS build-env

# Build Delve
RUN go install github.com/go-delve/delve/cmd/dlv@latest

# Final stage
FROM ubuntu

RUN apt-get update && apt-get install ca-certificates -y && update-ca-certificates

EXPOSE 40000

COPY --from=build-env /go/bin/dlv /

ARG TARGETOS
ARG TARGETARCH

ADD bin/$TARGETOS\_$TARGETARCH/crossplane /usr/local/bin/
ADD crds /crds
ADD webhookconfigurations /webhookconfigurations
<<<<<<< Updated upstream
EXPOSE 8080
USER 65532
ENTRYPOINT ["crossplane"]
||||||| Stash base
EXPOSE 8080
USER 65532
ENTRYPOINT ["crossplane"]
=======
#USER ROOT

ENTRYPOINT ["/dlv", "--listen=:40000", "--headless=true", "--api-version=2", "--accept-multiclient", "exec", "/usr/local/bin/crossplane", "--"]
>>>>>>> Stashed changes
